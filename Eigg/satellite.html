
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Satellite Imagery in OpenLayers - Azure Maps Web SDK Samples</title>

    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="This sample shows how to render Azure Maps Satellite/Aerial imagery tiles in the OpenLayers map control." />
    <meta name="keywords" content="Microsoft maps, map, gis, API, SDK, raster, imagery, satellite, aerial, tiles, Open Layers, OpenLayers" />
    <meta name="author" content="Microsoft Azure Maps" />

    <!-- Add references to the Azure Maps Map control JavaScript and CSS files. -->
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css" />
    <!-- The line below is only needed for old environments like Internet Explorer and Android 4.x -->
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
    <script src="https://openlayers.org/en/v4.6.5/build/ol.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.js"></script>
</head>
<body>
    <input id="fileInput" type="file"/>
    <div id="myMap"></div>
    <script type='text/javascript'>
        //Add your Azure Maps subscription key to the map SDK. Get an Azure Maps key at https://azure.com/maps
        var subscriptionKey = 'tTk1JVEaeNvDkxxnxHm9cYaCvqlOq1u-fXTvyXn2XkA';

        var map;

        function initialiseMapObj(){
            map = new ol.Map({
                target: 'myMap',
                layers: [
                    new ol.layer.Tile({
                        source: new ol.source.XYZ({
                            url: 'https://atlas.microsoft.com/map/imagery/png?api-version=1&style=satellite&tileSize=256&view=Auto&zoom={z}&x={x}&y={y}' +
                                '&subscription-key=' + subscriptionKey,
                            attributions: `Â© ${new Date().getFullYear()} DigitalGlobe, Microsoft`,
                            tileSize: 256
                        })
                    })
                ],
                view: new ol.View({
                    center: [0, 0],
                    zoom: 13
                })
            });

            map.getView().setCenter(ol.proj.transform([-6.1960333,56.907887], 'EPSG:4326', 'EPSG:3857'));
            map.getView().setZoom(13);

            return map;
        }

        function transformLatLonToMapObj(kz){
            return kz.map(coords => {
                const [ln, lat] = coords.split(",");
                return new ol.Feature({
                        geometry: new ol.geom.Point(ol.proj.transform([parseFloat(lat), parseFloat(ln)], 'EPSG:4326',     
                        'EPSG:3857')),
                    });
            });
        }

        function createMapLayer(kz, icon, scaled){
            var points = transformLatLonToMapObj(kz)

            const pinLayer = new ol.layer.Vector ({
            source: new ol.source.Vector ({
                    features: [...points]
                }),
                style: new ol.style.Style ({
                    image: new ol.style.Icon({
                        src: icon,
                        scale: scaled
                    })
                })
            });

            return pinLayer

        }

        function processData(allText) {
            var map = initialiseMapObj()
            var allText = JSON.parse(allText)

            var element = document.getElementById("fileInput");
            element.parentNode.removeChild(element);

            const locKeys = Object.keys(allText["natural"]);
            const industryKeys = Object.keys(allText["industry"])
            let residentialKeys = Object.keys(allText["residential"])
            const electricGrid = Object.keys(allText["electric"])
            
            map.addLayer(createMapLayer(locKeys.slice(0, 30), './binoculars/marker1.png', 0.015))
            map.addLayer(createMapLayer(residentialKeys.slice(0,10), './fullColMarkers/marker76.png', 0.03))
            map.addLayer(createMapLayer(electricGrid, './sparks/marker32.png', 0.1))
            map.addLayer(createMapLayer(residentialKeys.slice(12,35), './fullColMarkers/marker76.png', 0.03))
            map.addLayer(createMapLayer(industryKeys, './colouredMarkers/marker0.png', 0.03))

        }

        
        document.getElementById('fileInput').addEventListener('change', function selectedFileChanged() {
            const reader = new FileReader();
            Papa.parse(this.files[0], {
                complete: function(results) {
                    processData(results.data)
                }
            });
        });
    </script>
</body>
</html>